<div class="add-inventory-page">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">Add New Inventory Item</h1>
      <p class="page-subtitle">Fill in the details below to add a new item to inventory</p>
    </div>
    <button mat-icon-button (click)="onCancel()" class="close-btn" [disabled]="isLoading">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- Stepper -->
  <mat-stepper linear #stepper class="add-inventory-stepper">
    <!-- Step 1: Inventory Details -->
    <mat-step [stepControl]="inventoryForm" completed="false">
      <ng-template matStepLabel>Inventory Details</ng-template>
      
      <div class="step-content-wrapper">
        <form [formGroup]="inventoryForm" class="inventory-form">
          <!-- Main Content Area -->
          <div class="step-content-grid">
            <!-- Left Column: Form Fields -->
            <div class="form-section left-column">
              <div class="form-row">
                <!-- Barcode/SKU -->
                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>Barcode / SKU</mat-label>
                  <input matInput placeholder="Scan or enter barcode" formControlName="barcode" />
                  <mat-icon matPrefix>qr_code_2</mat-icon>
                  <mat-error *ngIf="inventoryForm.get('barcode')?.hasError('required')">Barcode is required</mat-error>
                </mat-form-field>

                <!-- SKU Field -->
                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>SKU</mat-label>
                  <input matInput placeholder="Enter SKU" formControlName="sku" />
                  <mat-icon matPrefix>tag</mat-icon>
                  <mat-error *ngIf="inventoryForm.get('sku')?.hasError('required')">SKU is required</mat-error>
                </mat-form-field>
              </div>

              <div class="form-row">
                <!-- Part Name -->
                <mat-form-field appearance="outline" class="form-field full-width">
                  <mat-label>Part Name</mat-label>
                  <input matInput placeholder="Enter part name" formControlName="partName" />
                  <mat-icon matPrefix>inventory_2</mat-icon>
                  <mat-error *ngIf="inventoryForm.get('partName')?.hasError('required')">Part name is required</mat-error>
                </mat-form-field>
              </div>

              <div class="form-row">
                <!-- Category -->
                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>Category</mat-label>
                  <mat-select formControlName="category">
                    <mat-option value="">Select Category</mat-option>
                    <mat-option value="Electronics">Electronics</mat-option>
                    <mat-option value="Wheels">Wheels</mat-option>
                    <mat-option value="Brakes">Brakes</mat-option>
                    <mat-option value="Accessories">Accessories</mat-option>
                    <mat-option value="Cables">Cables</mat-option>
                    <mat-option value="Motors">Motors</mat-option>
                  </mat-select>
                  <mat-icon matPrefix>category</mat-icon>
                  <mat-error *ngIf="inventoryForm.get('category')?.hasError('required')">Category is required</mat-error>
                </mat-form-field>

                <!-- Quantity -->
                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>Quantity</mat-label>
                  <input matInput type="number" placeholder="Enter quantity" formControlName="quantity" />
                  <mat-icon matPrefix>numbers</mat-icon>
                  <mat-error *ngIf="inventoryForm.get('quantity')?.hasError('required')">Quantity is required</mat-error>
                </mat-form-field>
              </div>

              <div class="form-row">
                <!-- Location -->
                <mat-form-field appearance="outline" class="form-field full-width">
                  <mat-label>Storage Location</mat-label>
                  <input matInput placeholder="e.g., Bin A-14" formControlName="location" />
                  <mat-icon matPrefix>location_on</mat-icon>
                </mat-form-field>
              </div>

              <div class="form-row">
                <!-- Description -->
                <mat-form-field appearance="outline" class="form-field full-width">
                  <mat-label>Description</mat-label>
                  <textarea matInput placeholder="Enter item description" formControlName="description" rows="3"></textarea>
                  <mat-icon matPrefix>description</mat-icon>
                </mat-form-field>
              </div>

              <!-- Image Upload Section -->
              <div class="image-upload-section">
                <h4 class="section-title">Product Image</h4>
                <div class="image-upload-area">
                  <input type="file" #fileInput hidden (change)="onImageSelected($event)" accept="image/*" />
                  
                  <div *ngIf="!imagePreview" class="upload-placeholder" (click)="fileInput.click()">
                    <mat-icon class="upload-icon">cloud_upload</mat-icon>
                    <p class="upload-text">Click to upload or drag and drop</p>
                    <p class="upload-subtext">PNG, JPG, GIF up to 5MB</p>
                  </div>

                  <div *ngIf="imagePreview" class="image-preview">
                    <img [src]="imagePreview" alt="Product preview" />
                    <button mat-icon-button (click)="fileInput.click()" class="change-btn">
                      <mat-icon>edit</mat-icon>
                    </button>
                  </div>
                </div>
              </div>

              <!-- Base Price Section -->
              <div class="price-section">
                <h4 class="section-title">Pricing Information</h4>
                <div class="form-row">
                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>Base Price</mat-label>
                    <input matInput type="number" placeholder="Enter base price" formControlName="basePrice" />
                    <mat-icon matPrefix>attach_money</mat-icon>
                    <mat-error *ngIf="inventoryForm.get('basePrice')?.hasError('required')">Base price is required</mat-error>
                  </mat-form-field>
                </div>

                <!-- GST Section -->
                <div class="gst-section">
                  <h5 class="subsection-title">GST (Goods and Services Tax)</h5>
                  
                  <div class="radio-group">
                    <mat-radio-group formControlName="includeGST" class="radio-options">
                      <mat-radio-button value="yes" class="radio-button">
                        <span class="radio-label">Include GST</span>
                      </mat-radio-button>
                      <mat-radio-button value="no" class="radio-button">
                        <span class="radio-label">No GST</span>
                      </mat-radio-button>
                    </mat-radio-group>
                  </div>

                  <!-- GST Percentages (shown when GST is enabled) -->
                  <div *ngIf="inventoryForm.get('includeGST')?.value === 'yes'" class="gst-fields">
                    <div class="form-row">
                      <mat-form-field appearance="outline" class="form-field">
                        <mat-label>SGST %</mat-label>
                        <input matInput type="number" placeholder="Enter SGST %" formControlName="sgstPercentage" />
                        <mat-icon matPrefix>percent</mat-icon>
                      </mat-form-field>

                      <mat-form-field appearance="outline" class="form-field">
                        <mat-label>CGST %</mat-label>
                        <input matInput type="number" placeholder="Enter CGST %" formControlName="cgstPercentage" />
                        <mat-icon matPrefix>percent</mat-icon>
                      </mat-form-field>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- GST Calculation Summary - Below Form -->
          <div class="calculation-summary-section">
            <!-- GST Calculation (with GST) -->
            <div class="calculation-section-wrapper" *ngIf="inventoryForm.get('includeGST')?.value === 'yes'">
              <div class="calculation-card">
                <h4 class="calc-title">
                  <mat-icon>calculate</mat-icon>
                  Price Calculation
                </h4>
                
                <div class="calc-item">
                  <span class="calc-label">Base Price:</span>
                  <span class="calc-value">₹ {{ basePrice | number:'1.2-2' }}</span>
                </div>

                <div class="divider"></div>

                <div class="calc-item sgst-item">
                  <span class="calc-label">SGST ({{ sgstPercentage }}%):</span>
                  <span class="calc-value sgst-value">₹ {{ sgstAmount | number:'1.2-2' }}</span>
                </div>

                <div class="calc-item cgst-item">
                  <span class="calc-label">CGST ({{ cgstPercentage }}%):</span>
                  <span class="calc-value cgst-value">₹ {{ cgstAmount | number:'1.2-2' }}</span>
                </div>

                <div class="divider"></div>

                <div class="calc-item total-item">
                  <span class="calc-label total-label">Total Price (with GST):</span>
                  <span class="calc-value total-value">₹ {{ totalWithGST | number:'1.2-2' }}</span>
                </div>

                <div class="tax-info">
                  <mat-icon>info</mat-icon>
                  <p>GST amount will be calculated automatically based on the percentages provided.</p>
                </div>
              </div>
            </div>

            <!-- Price Summary (without GST) -->
            <div class="calculation-section-wrapper" *ngIf="inventoryForm.get('includeGST')?.value === 'no'">
              <div class="calculation-card">
                <h4 class="calc-title">
                  <mat-icon>check_circle</mat-icon>
                  Price Summary
                </h4>
                
                <div class="calc-item">
                  <span class="calc-label">Base Price:</span>
                  <span class="calc-value">₹ {{ basePrice | number:'1.2-2' }}</span>
                </div>

                <div class="divider"></div>

                <div class="calc-item total-item">
                  <span class="calc-label total-label">Total Price:</span>
                  <span class="calc-value total-value">₹ {{ basePrice | number:'1.2-2' }}</span>
                </div>

                <div class="tax-info">
                  <mat-icon>info</mat-icon>
                  <p>No GST will be applied to this item.</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Step Actions -->
          <div class="step-actions">
            <button mat-stroked-button (click)="onCancel()" [disabled]="isLoading">
              Cancel
            </button>
            <button mat-raised-button color="primary" (click)="stepper.next()" 
              [disabled]="!inventoryForm.valid || isLoading" class="submit-btn">
              <span>Review Details</span>
            </button>
          </div>
        </form>
      </div>
    </mat-step>

    <!-- Step 2: Review & Confirm -->
    <mat-step>
      <ng-template matStepLabel>Review & Confirm</ng-template>
      
      <div class="step-content">
        <div class="review-section">
          <h3 class="review-title">
            <mat-icon>check_circle</mat-icon>
            Inventory Item Details
          </h3>

          <div class="review-grid">
            <div class="review-item">
              <span class="review-label">Barcode:</span>
              <span class="review-value">{{ inventoryForm.get('barcode')?.value }}</span>
            </div>
            <div class="review-item">
              <span class="review-label">SKU:</span>
              <span class="review-value">{{ inventoryForm.get('sku')?.value }}</span>
            </div>
            <div class="review-item full-width">
              <span class="review-label">Part Name:</span>
              <span class="review-value">{{ inventoryForm.get('partName')?.value }}</span>
            </div>
            <div class="review-item">
              <span class="review-label">Category:</span>
              <span class="review-value">{{ inventoryForm.get('category')?.value }}</span>
            </div>
            <div class="review-item">
              <span class="review-label">Quantity:</span>
              <span class="review-value">{{ inventoryForm.get('quantity')?.value }}</span>
            </div>
            <div class="review-item">
              <span class="review-label">Location:</span>
              <span class="review-value">{{ inventoryForm.get('location')?.value }}</span>
            </div>
            <div class="review-item full-width">
              <span class="review-label">Base Price:</span>
              <span class="review-value">₹ {{ inventoryForm.get('basePrice')?.value | number:'1.2-2' }}</span>
            </div>

            <!-- GST Details -->
            <div class="review-item" *ngIf="inventoryForm.get('includeGST')?.value === 'yes'">
              <span class="review-label">SGST:</span>
              <span class="review-value">{{ inventoryForm.get('sgstPercentage')?.value }}% (₹ {{ sgstAmount | number:'1.2-2' }})</span>
            </div>
            <div class="review-item" *ngIf="inventoryForm.get('includeGST')?.value === 'yes'">
              <span class="review-label">CGST:</span>
              <span class="review-value">{{ inventoryForm.get('cgstPercentage')?.value }}% (₹ {{ cgstAmount | number:'1.2-2' }})</span>
            </div>
            <div class="review-item total-review-item" *ngIf="inventoryForm.get('includeGST')?.value === 'yes'">
              <span class="review-label total-review-label">Total (with GST):</span>
              <span class="review-value total-review-value">₹ {{ totalWithGST | number:'1.2-2' }}</span>
            </div>
          </div>
        </div>

        <!-- Step Actions -->
        <div class="step-actions">
          <button mat-stroked-button (click)="stepper.previous()" [disabled]="isLoading">
            Back
          </button>
          <button mat-stroked-button (click)="onCancel()" [disabled]="isLoading">
            Cancel
          </button>
          <button mat-raised-button color="primary" (click)="onSubmit()" 
            [disabled]="isLoading" class="submit-btn">
            <mat-spinner diameter="20" *ngIf="isLoading" class="loading-spinner"></mat-spinner>
            <span *ngIf="!isLoading">Confirm & Add Item</span>
          </button>
        </div>
      </div>
    </mat-step>
  </mat-stepper>
</div>
